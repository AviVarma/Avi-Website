<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  {{ partial "head/resource-hints.html" . }}
  {{ partial "head/seo.html" . }}


  <!-- Extensibility -->
  {{ partial "head_start.html" . }}


  <!-- Styles -->
  {{ $defaultTheme := .Param "defaultTheme" | default "light" }}

  {{ $critical := resources.Get "css/_critical.css" | resources.PostCSS }}
  {{ $prismDark := resources.Get "prism-themes/prism-gruvbox-dark.css" }}
  {{ $prismLight := resources.Get "prism-themes/prism-gruvbox-light.css" }}
  {{ $prism := resources.Get "css/prism.css" | resources.ExecuteAsTemplate "css/prism.css" . | resources.PostCSS }}
  {{ $nonCritical := resources.Get "css/_non-critical.css" | resources.PostCSS }}
  {{ $bundle := slice $prism $nonCritical | resources.Concat "css/bundle.css" }}

  {{ if hugo.IsProduction }}
    {{ $critical = $critical | resources.PostProcess }}
    {{ $prismDark = $prismDark | minify | fingerprint "sha512" }}
    {{ $prismLight = $prismLight | minify | fingerprint "sha512" }}
    {{ $bundle = $bundle | fingerprint "sha512" | resources.PostProcess }}

    <style>
      /* stylelint-disable */
      {{ $critical.Content | safeCSS }}
      /* stylelint-enable */
    </style>

    <link
      id="prism-dark"
      rel="preload"
      href="{{ $prismDark.RelPermalink }}"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
      integrity="{{ $prismDark.Data.Integrity }}"
      {{ if eq $defaultTheme "light" }}disabled{{ end }}
    />
    <link
      id="prism-light"
      rel="preload"
      href="{{ $prismLight.RelPermalink }}"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
      integrity="{{ $prismLight.Data.Integrity }}"
      {{ if eq $defaultTheme "dark" }}disabled{{ end }}
    />
    <link
      rel="preload"
      href="{{ $bundle.RelPermalink }}"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
      integrity="{{ $bundle.Data.Integrity }}"
    />

    <noscript>
      {{ if eq $defaultTheme "light" }}
        <link
          rel="stylesheet"
          href="{{ $prismLight.RelPermalink }}"
          integrity="{{ $prismLight.Data.Integrity }}"
        />
      {{ else }}
        <link
          rel="stylesheet"
          href="{{ $prismDark.RelPermalink }}"
          integrity="{{ $prismDark.Data.Integrity }}"
        />
      {{ end }}
      <link
        rel="stylesheet"
        href="{{ $bundle.RelPermalink }}"
        integrity="{{ $bundle.Data.Integrity }}"
      />
    </noscript>
  {{ else }}

    <style>
      /* stylelint-disable */
      {{ $critical.Content | safeCSS }}
      /* stylelint-enable */
    </style>

    <link
      id="prism-dark"
      rel="preload"
      href="{{ $prismDark.RelPermalink }}"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
      {{ if eq $defaultTheme "light" }}disabled{{ end }}
    />
    <link
      id="prism-light"
      rel="preload"
      href="{{ $prismLight.RelPermalink }}"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
      {{ if eq $defaultTheme "dark" }}disabled{{ end }}
    />
    <link
      rel="preload"
      href="{{ $bundle.RelPermalink }}"
      as="style"
      onload="this.onload=null;this.rel='stylesheet'"
    />

    <noscript>
      {{ if eq $defaultTheme "light" }}
        <link
          rel="stylesheet"
          href="{{ $prismLight.RelPermalink }}"
        />
      {{ else }}
        <link
          rel="stylesheet"
          href="{{ $prismDark.RelPermalink }}"
        />
      {{ end }}
      <link
        rel="stylesheet"
        href="{{ $bundle.RelPermalink }}"
      />
    </noscript>
  {{ end }}


  <link rel="icon" href="/img/favicon.svg" sizes="any" type="image/svg+xml" />

  <!-- Extensibility -->
  {{ partial "head_end.html" . }}
</head>
